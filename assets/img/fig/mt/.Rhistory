legend("top",paste("Saldo Migratorio:",smig,"Personas"),cex=1.2,col="red")
legend("bottomleft","Municipio de Origen",cex=0.8,text.col="blue")
legend("bottomright","Municipio de Destino",cex=0.8,text.col="blue")
dev.off()
kk<-kk+1
}
}
##########################
#####################################
# Objetivo: Perfiles Migracion interna de toda la vida 2012
# Autor: Alvaro Chirino
# Version: 0
#####################################
rm(list=ls())
#directoros de trabajo
#mac
dta<-"/Users/iMac6/Desktop/_ARU2018/20_Migracion/dta"
tex<-"/Users/iMac6/Desktop/_ARU2018/20_Migracion/!perfil/2012/mt"
shp<-"/Users/iMac6/Desktop/_ARU2018/20_Migracion/shp"
rcran<-"/Users/iMac6/Dropbox/17.MigracionInterna/"
imun<-"/Users/iMac6/Desktop/_ARU2016/17.MigracionInterna/_tex2/imun"
######################################
#librerias
#install.packages("plotrix")
#install.packages("tmap")
library(tmap)
library(foreign)
#install.packages("googleVis")
library(googleVis)
#install.packages("rgdal")
#install.packages("ggplot2")
library(rgdal)
library(ggplot2)
library(plotrix)
######################################
setwd(dta)
mun.in<-read.dta("inmt12.dta")
mun.out<-read.dta("outmt12.dta")
mun.per<-read.dta("permt12.dta")
names(mun.in)[1]<-"imun"
names(mun.out)[1]<-"imun"
names(mun.per)[1]<-"imun"
deptv<-read.dta("matMT2012mun.dta")
saldo<-read.dta("migracionOIM_92-12mun.dta")
saldo
saldo[,saldo$key==1]
saldo[,saldo$key]
saldo<-read.dta("migracionOIM_92-12mun.dta")
##################################################
#River PLOT, top 5 de destinos
#################################################
#install.packages("riverplot")
library(riverplot)
kk<-1
for(i in 1:339){
if(cimun[i]==codmun[kk] & kk<=6){
print(codmun[kk])
#i<-2
oin<-order(deptv[i,2:340],decreasing = T)[1:5]
dtin<-as.numeric(prop.table(deptv[i,2:340])*100)
oout<-order(deptv[,i+1],decreasing = T)[1:5]
dtout<-prop.table(deptv[,i+1])*100
#colores
colin<-colors()[grep("red",colors())]
colout<-colors()[grep("green",colors())]
omun<-order(mun@data$CODIGO)
ndep<-mun@data$NOM_MUN[omun][1:339]
nodes <- c(paste("i",1:5,sep=""),"p",paste("e",1:5,sep=""))
edges <- list( p = list(e1=dtout[oout[1]],e2=dtout[oout[2]],e3=dtout[oout[3]],e4=dtout[oout[4]],e5=dtout[oout[5]])
,i1=list(p=dtin[oin[1]]),i2=list(p=dtin[oin[2]]),i3=list(p=dtin[oin[3]]),i4=list(p=dtin[oin[4]]),i5=list(p=dtin[oin[5]]))
nflujo<-paste("flujo",codmun[kk],".pdf",sep="")
pdf(nflujo,width=9,height =  6)
#saldo migratorio
smig<-saldo[saldo$imun==codmun[kk],"smmt12"]
r <- makeRiver( nodes, edges,node_labels=c(paste(ndep[oin]," ",round(dtin[oin],2),"%",sep=""),ndep[i],paste(ndep[oout]," ",round(dtout[oout],2),"%",sep="")),
node_styles= list(p=list(col=colout[6]) ,i1=list(col=colout[1]),i2=list(col=colout[2])
,i3=list(col=colout[3]),i4=list(col=colout[4]),i5=list(col=colout[5])
, e1=list(col=colin[1]), e2=list(col=colin[2])
, e3=list(col=colin[3]), e4=list(col=colin[4]), e5=list(col=colin[5])))
plot(r,plot_area=0.7, node_margin = 0.2, nodewidth = 3,yscale=1)
pt<-par("usr")
#text(pt[2]/2,pt[4]/2,"Flujo Migratorio: Los 5 Principales Destinos de Entrada y Salida",cex=1.5,lwd=3,col="brown")
legend("top",paste("Saldo Migratorio:",smig,"Personas"),cex=1.2,col="red")
legend("bottomleft","Municipio de Origen",cex=0.8,text.col="blue")
legend("bottomright","Municipio de Destino",cex=0.8,text.col="blue")
dev.off()
kk<-kk+1
}
}
#####################################
# Objetivo: Perfiles Migracion interna de toda la vida 2012
# Autor: Alvaro Chirino
# Version: 0
#####################################
rm(list=ls())
#directoros de trabajo
#mac
dta<-"/Users/iMac6/Desktop/_ARU2018/20_Migracion/dta"
tex<-"/Users/iMac6/Desktop/_ARU2018/20_Migracion/!perfil/2012/mt"
shp<-"/Users/iMac6/Desktop/_ARU2018/20_Migracion/shp"
rcran<-"/Users/iMac6/Dropbox/17.MigracionInterna/"
imun<-"/Users/iMac6/Desktop/_ARU2016/17.MigracionInterna/_tex2/imun"
######################################
#librerias
#install.packages("plotrix")
#install.packages("tmap")
library(tmap)
library(foreign)
#install.packages("googleVis")
library(googleVis)
#install.packages("rgdal")
#install.packages("ggplot2")
library(rgdal)
library(ggplot2)
library(plotrix)
######################################
setwd(dta)
mun.in<-read.dta("inmt12.dta")
mun.out<-read.dta("outmt12.dta")
mun.per<-read.dta("permt12.dta")
names(mun.in)[1]<-"imun"
names(mun.out)[1]<-"imun"
names(mun.per)[1]<-"imun"
deptv<-read.dta("matMT2012mun.dta")
saldo<-read.dta("migracionOIM_92-12mun.dta")
######################################
###Codigo de Municpios
codmun<-mun.in$imun
##############
#Edad
##############
setwd(tex)
for(i in codmun){
print(i)
#  i<-codmun[1]
ages_in<-paste("agesin",i,".pdf",sep="")
ages_out<-paste("agesout",i,".pdf",sep="")
ages_per<-paste("agesper",i,".pdf",sep="")
gagein<-data.frame(grupo=c("0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85-89","90-94","95-99"),valor=c(t(mun.in[mun.in$imun==i,6:25]*100)))
gageout<-data.frame(grupo=c("0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85-89","90-94","95-99"),valor=c(t(mun.out[mun.out$imun==i,6:25]*100)))
gageper<-data.frame(grupo=c("0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85-89","90-94","95-99"),valor=c(t(mun.per[mun.per$imun==i,6:25]*100)))
medadin<-mun.in[mun.in$imun==i,"edad"]
medadout<-mun.out[mun.out$imun==i,"edad"]
medadper<-mun.per[mun.per$imun==i,"edad"]
yy<-30
#in
pdf(ages_in,width = 9)
plot(1:20,gagein$valor,type="h",lwd=5,axes=F,xlab="Grupos de edad",ylab="Porcentaje",ylim=c(0,yy))
axis(1,1:20,gagein$grupo,cex=0.6,col="brown")
axis(2,1:yy,cex=0.6,col="brown")
text(1:20,gagein$valor,round(gagein$valor,2),cex=1,col="blue",pos=3)
text(14,13,paste("Promedio de edad:",round(medadin,2),"años"),cex=0.9,col="brown",pos=4)
rect(14,12,20,14,lwd=1.5)
title(main="Grupos de Edad, Inmigrantes",cex.main=2,col.main="brown")
dev.off()
#out
pdf(ages_out,width = 9)
plot(1:20,gageout$valor,type="h",lwd=5,axes=F,xlab="Grupos de edad",ylab="Porcentaje",ylim=c(0,yy))
axis(1,1:20,gageout$grupo,cex=0.6,col="brown")
axis(2,1:yy,cex=0.6,col="brown")
text(1:20,gageout$valor,round(gageout$valor,2),cex=1,col="blue",pos=3)
text(14,13,paste("Promedio de edad:",round(medadout,2),"años"),cex=0.9,col="brown",pos=4)
rect(14,12,20,14,lwd=1.5)
title(main="Grupos de Edad, Emigrantes",cex.main=2,col.main="brown")
dev.off()
#per
pdf(ages_per,width = 9)
plot(1:20,gageper$valor,type="h",lwd=5,axes=F,xlab="Grupos de edad",ylab="Porcentaje",ylim=c(0,yy))
axis(1,1:20,gageper$grupo,cex=0.6,col="brown")
axis(2,1:yy,cex=0.6,col="brown")
text(1:20,gageper$valor,round(gageper$valor,2),cex=1,col="blue",pos=3)
text(14,13,paste("Promedio de edad:",round(medadper,2),"años"),cex=0.9,col="brown",pos=4)
rect(14,12,20,14,lwd=1.5)
title(main="Grupos de Edad, Permanecieron",cex.main=2,col.main="brown")
dev.off()
}
################
#grandes grupos#
################
for(i in codmun){
print(i)
ageg_in<-paste("agegin",i,".pdf",sep="")
ageg_out<-paste("agegout",i,".pdf",sep="")
ageg_per<-paste("agegper",i,".pdf",sep="")
#data
gagein<-data.frame(grupo=c("0-14","15-64","65 y más"),valor=c(t(mun.in[mun.in$imun==i,26:28]*100)))
gageout<-data.frame(grupo=c("0-14","15-64","65 y más"),valor=c(t(mun.out[mun.out$imun==i,26:28]*100)))
gageper<-data.frame(grupo=c("0-14","15-64","65 y más"),valor=c(t(mun.per[mun.per$imun==i,26:28]*100)))
#in
pdf(ageg_in)
d1<-barplot(gagein$valor,names.arg=gagein$grupo,width=gagein$valor/10,horiz=T,col=c("green","blue","red"),xlim=c(0,100),density=10)
text(gagein$valor,d1,paste(round(gagein$valor,2),"%"),cex=1.1,pos=4)
title(main="Grandes Grupos de Edad, Inmigrantes",cex.main=2,col.main="brown")
dev.off()
#out
pdf(ageg_out)
d1<-barplot(gageout$valor,names.arg=gageout$grupo,width=gageout$valor/10,horiz=T,col=c("green","blue","red"),xlim=c(0,100),density=10)
text(gageout$valor,d1,paste(round(gageout$valor,2),"%"),cex=1.1,pos=4)
title(main="Grandes Grupos de Edad, Emigrantes",cex.main=2,col.main="brown")
dev.off()
#per
pdf(ageg_per)
d1<-barplot(gageper$valor,names.arg=gageper$grupo,width=gageper$valor/10,horiz=T,col=c("green","blue","red"),xlim=c(0,100),density=10)
text(gageper$valor,d1,paste(round(gageper$valor,2),"%"),cex=1.1,pos=4)
title(main="Grandes Grupos de Edad, Permanecieron",cex.main=2,col.main="brown")
dev.off()
}
###########################
#Categoria ocupacional#
###########################
ctl<-c("Asalariado","Cuenta Propia","Empleador","Aprendiz S/R","Trabajador/a del hogar","Cooperativista")
for(i in codmun){
print(i)
ct_in<-paste("ctin",i,".pdf",sep="")
ct_out<-paste("ctout",i,".pdf",sep="")
ct_per<-paste("ctper",i,".pdf",sep="")
#data
ctin<-mun.in[mun.in$imun==i,31:36]*100
ctout<-mun.out[mun.out$imun==i,31:36]*100
ctper<-mun.per[mun.per$imun==i,31:36]*100
#in
pdf(ct_in)
par(cex.axis=1.5)
radial.plot(ctin,rp.type="s",labels=ctl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=1,mar=c(3.5,3.5,3.5,3.5),point.col = "red",point.symbols = 8)
radial.plot(ctin,rp.type="p",labels=ctl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=1,mar=c(3.5,3.5,3.5,3.5),add=T)
title(main="Categoria Ocupacional (%), Inmigración",cex.main=2,col.main="darkred")
dev.off()
#out
pdf(ct_out)
par(cex.axis=1.5)
radial.plot(ctout,rp.type="s",labels=ctl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=1,mar=c(3.5,3.5,3.5,3.5),point.col = "red",point.symbols = 8)
radial.plot(ctout,rp.type="p",labels=ctl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=1,mar=c(3.5,3.5,3.5,3.5),add=T)
title(main="Categoria Ocupacional (%), Emigración",cex.main=2,col.main="darkred")
dev.off()
#per
pdf(ct_per)
par(cex.axis=1.5)
radial.plot(ctper,rp.type="s",labels=ctl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=1,mar=c(3.5,3.5,3.5,3.5),point.col = "red",point.symbols = 8)
radial.plot(ctper,rp.type="p",labels=ctl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=1,mar=c(3.5,3.5,3.5,3.5),add=T)
title(main="Categoria Ocupacional (%), Permanecieron",cex.main=2,col.main="darkred")
dev.off()
}
#####################
#Actividad Principal#
#####################
actl<-c("Agropecuaria/silvicultura"
,"Mineria"
,"Manufactura"
,"Suministro de energia"
,"Suministro de agua"
, "Construcción"
,"Comercio"
,"Transporte y almacenamiento"
,"Alojamiento/Comida"
,"Información/comunicaciones"
,"Financieras/seguros"
,"Inmobiliaria"
,"Profesionales/científicas/técnicas"
,"Servicios administrativos y de apoyo"
,"Administración pública"
,"Servicios de Educación"
,"Servicios de salud / asistencia social"
,"Actividades artísticas / entretenimiento"
,"Otras actividades de servicios"
,"Actividades de los hogares privados como empleadores"
,"Servicios de organizaciones y organos extraterritoriales")
for(i in codmun){
print(i)
#i<-1
act_in<-paste("actin",i,".pdf",sep="")
act_out<-paste("actout",i,".pdf",sep="")
act_per<-paste("actper",i,".pdf",sep="")
#data
actin<-mun.in[mun.in$imun==i,37:57]*100
actout<-mun.out[mun.out$imun==i,37:57]*100
actper<-mun.per[mun.per$imun==i,37:57]*100
#in
pdf(act_in)
o<-order(actin,decreasing = T)
dac<-actin[o][1:5]
dacl<-actl[o][1:5]
par(cex.axis=1.25)
radial.plot(dac,rp.type="s",labels=dacl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=-1,mar=c(4.5,4.5,4.5,4.5),point.col = "red",point.symbols = 8)
radial.plot(dac,rp.type="p",labels=dacl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=-1,mar=c(4.5,4.5,4.5,4.5),add=T)
title(main="Principales actividades económicas (%), Inmigración",cex.main=1.7,col.main="darkred")
dev.off()
#out
pdf(act_out)
o<-order(actout,decreasing = T)
dac<-actout[o][1:5]
dacl<-actl[o][1:5]
par(cex.axis=1.25)
radial.plot(dac,rp.type="s",labels=dacl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=-1,mar=c(4.5,4.5,4.5,4.5),point.col = "red",point.symbols = 8)
radial.plot(dac,rp.type="p",labels=dacl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=-1,mar=c(4.5,4.5,4.5,4.5),add=T)
title(main="Principales actividades económicas (%), Emigración",cex.main=1.7,col.main="darkred")
dev.off()
#per
pdf(act_per)
o<-order(actper,decreasing = T)
dac<-actper[o][1:5]
dacl<-actl[o][1:5]
par(cex.axis=1.25)
radial.plot(dac,rp.type="s",labels=dacl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=-1,mar=c(4.5,4.5,4.5,4.5),point.col = "red",point.symbols = 8)
radial.plot(dac,rp.type="p",labels=dacl,lwd=2,label.prop=1,line.col = "blue"
,show.grid.labels=1,start=-1,mar=c(4.5,4.5,4.5,4.5),add=T)
title(main="Principales actividades económicas (%), Permanecieron",cex.main=1.7,col.main="darkred")
dev.off()
}
#######################
##MAPAS Departamentos##
######################
#Ubicacion Departamentos
setwd(shp)
dep<-readOGR(shp,"limite_departamental",stringsAsFactors=F)
mun<-readOGR(shp,"municipios",stringsAsFactors=F)
dep$COD_DEP<-as.numeric(dep$COD_DEP)
dep$COD_DEP[is.na(dep$COD_DEP)==T]<-0
mun$COD_DEP<-as.numeric(mun$COD_DEP)
mun$COD_DEP[is.na(mun$COD_DEP)==T]<-0
setwd(tex)
for(i in codmun){
#i<-codmun[200]
print(i)
idep<-as.numeric(substr(i,2,2))
name<-paste("mun",i,".pdf",sep="")
pdf(name)
a<-qtm(dep[dep$COD_DEP==idep,],fill="white")+qtm(mun[mun$COD_DEP==idep,],fill="white")+qtm(mun[mun@data$CODIGO==i,],fill="red")
print(a)
dev.off()
}
#sexo 2
for(i in codmun){
print(i)
nsexin<-paste("sexin",i,".pdf",sep="")
nsexout<-paste("sexout",i,".pdf",sep="")
nsexper<-paste("sexper",i,".pdf",sep="")
#DATA
sexin<-data.frame(sexo=c("Mujeres","Hombres"),valor=c(mun.in[mun.in$imun==i,"female"]*100,mun.in[mun.in$imun==i,"male"]*100))
sexout<-data.frame(sexo=c("Mujeres","Hombres"),valor=c(mun.out[mun.out$imun==i,"female"]*100,mun.out[mun.out$imun==i,"male"]*100))
sexper<-data.frame(sexo=c("Mujeres","Hombres"),valor=c(mun.per[mun.per$imun==i,"female"]*100,mun.per[mun.per$imun==i,"male"]*100))
pdf(nsexin)
par(cex.axis=1.8,cex.lab=1.5)
radial.pie(c(sexin$valor[1],60,sexin$valor[2],0),labels=c(round(sexin$valor[1],2),"",round(sexin$valor[2],2),""),sector.colors=c("blue","transparent","pink","transparent"),label.prop=1.1)
legend(-38,31,legend=sexin$sexo,col=c("pink","blue"),lty=1,lwd=3,horiz=F)
title(main="Sexo, Inmigrantes",cex.main=2,col.main="brown")
dev.off()
pdf(nsexout)
par(cex.axis=1.8,cex.lab=1.5)
radial.pie(c(sexout$valor[1],60,sexout$valor[2],0),labels=c(round(sexout$valor[1],2),"",round(sexout$valor[2],2),""),sector.colors=c("blue","transparent","pink","transparent"),label.prop=1.1)
legend(-38,31,legend=sexout$sexo,col=c("pink","blue"),lty=1,lwd=3,horiz=F)
title(main="Sexo, Emigrantes",cex.main=2,col.main="brown")
dev.off()
pdf(nsexper)
par(cex.axis=1.8,cex.lab=1.5)
radial.pie(c(sexper$valor[1],60,sexper$valor[2],0),labels=c(round(sexper$valor[1],2),"",round(sexper$valor[2],2),""),sector.colors=c("blue","transparent","pink","transparent"),label.prop=1.1)
legend(-38,31,legend=sexper$sexo,col=c("pink","blue"),lty=1,lwd=3,horiz=F)
title(main="Sexo, Permanecieron",cex.main=2,col.main="brown")
dev.off()
}
##########################
#gauge etnia años de educacion
##########################
setwd(rcran)
source("gauge.R")
setwd(tex)
#######################
#####Años de educacion
#######################
colyedu<-colors()[grep("blue",colors())]
for(i in codmun){
print(i)
#i<-codmun[1]
yedui<-paste0("yedui",i,".pdf")
yeduo<-paste0("yeduo",i,".pdf")
yedup<-paste0("yedup",i,".pdf")
#data
yei<-round(mun.in[mun.in$imun==i,"yedu"],2)
yeo<-round(mun.out[mun.out$imun==i,"yedu"],2)
yep<-round(mun.per[mun.per$imun==i,"yedu"],2)
#plots
pdf(yedui,height = 4)
p<-gg.gauge(yei,breaks=c(0,4,8,12),main="Años de Educación",color=colyedu[c(23,25,14)])
#p<-gg.gauge(yei,breaks=c(0,4,8,12),main="Años de educación",color=colyedu[c(20,40,30)]) green
print(p)
dev.off()
######################
pdf(yeduo,height = 4)
p<-gg.gauge(yeo,breaks=c(0,4,8,12),main="Años de Educación",color=colyedu[c(23,25,14)])
print(p)
dev.off()
pdf(yedup,height = 4)
p<-gg.gauge(yep,breaks=c(0,4,8,12),main="Años de Educación",color=colyedu[c(23,25,14)])
print(p)
dev.off()
}
#######################
#####etnia
#######################
coletnia<-colors()[grep("brown",colors())]
for(i in codmun){
print(i)
etniai<-paste0("etniai",i,".pdf")
etniao<-paste0("etniao",i,".pdf")
etniap<-paste0("etniap",i,".pdf")
#data
eti<-round(mun.in[mun.in$imun==i,"etnia"]*100,2)
eto<-round(mun.out[mun.out$imun==i,"etnia"]*100,2)
etp<-round(mun.per[mun.per$imun==i,"etnia"]*100,2)
pdf(etniai,height = 4)
p<-gg.gauge(eti,breaks=c(0,35,70,100),main="Identificación Indígena",color=coletnia[c(12,10,11)])
print(p)
dev.off()
######################
pdf(etniao,height = 4)
p<-gg.gauge(eto,breaks=c(0,35,70,100),main="Identificación Indígena",color=coletnia[c(12,10,11)])
print(p)
dev.off()
######################
pdf(etniap,height = 4)
p<-gg.gauge(etp,breaks=c(0,35,70,100),main="Identificación Indígena",color=coletnia[c(12,10,11)])
print(p)
dev.off()
}
##############################################
#Mapa tematico
##############################################
#Ingreso entraron
#################
#Cortes del mapa
dep@data[,"idep"]<-paste("0",dep$COD_DEP,sep="")
gin<-c(0,5,20,50,100)
gout<-c(0,5,20,50,100)
colout<-c("white","darkred")
colin<-c("white","darkgreen")
cimun<-deptv$imun
kk<-1
for(i in 1:339){
if(cimun[i]==codmun[kk] & kk<=6){
print(codmun[kk])
mpin<-paste("mpi",codmun[kk],".pdf",sep="")
mpout<-paste("mpo",codmun[kk],".pdf",sep="")
#data
indep<-data.frame(CODIGO=cimun,ind=c(t(prop.table(deptv[i,c(-1)])*100)))
outdep<-data.frame(CODIGO=cimun,outd=c((prop.table(deptv[,i+1])*100)))
muntm<-mun
o<-order(muntm@data[,"CODIGO"])
muntm@data[o,"ind"]<-c(indep$ind,NA,NA,NA,NA,NA)
muntm@data[o,"outdep"]<-c(outdep$outd,NA,NA,NA,NA,NA)
pdf(mpin)
m1<-qtm(muntm[is.na(muntm$ind)==F,],fill.palette=colin ,fill="ind",style="beaver",fill.title="% Inmigración",fill.style="fixed",fill.breaks=gin)+tm_legend(text.size=1.3,position = c("right","top"), frame="gray50",title.size=1.5)+tm_shape(dep)+tm_polygons("blue",alpha=0,lwd=2)+tm_layout(legend.format = list(text.separator = "-"))
print(m1)
dev.off()
pdf(mpout)
m2<-qtm(muntm[is.na(muntm$ind)==F,],fill.palette=colout,fill="outdep",style="beaver",fill.title="% Emigración",fill.style="fixed",fill.breaks=gout)+tm_legend(text.size=1.3,position = c("right","top"), frame="gray50",title.size=1.5)+tm_shape(dep)+tm_polygons("blue",alpha=0,lwd=2)+tm_layout(legend.format = list(text.separator = "-"))
print(m2)
dev.off()
kk<-kk+1
}
}
##################################################
#River PLOT, top 5 de destinos
#################################################
#install.packages("riverplot")
library(riverplot)
kk<-1
for(i in 1:339){
if(cimun[i]==codmun[kk] & kk<=6){
print(codmun[kk])
#i<-2
oin<-order(deptv[i,2:340],decreasing = T)[1:5]
dtin<-as.numeric(prop.table(deptv[i,2:340])*100)
oout<-order(deptv[,i+1],decreasing = T)[1:5]
dtout<-prop.table(deptv[,i+1])*100
#colores
colin<-colors()[grep("red",colors())]
colout<-colors()[grep("green",colors())]
omun<-order(mun@data$CODIGO)
ndep<-mun@data$NOM_MUN[omun][1:339]
nodes <- c(paste("i",1:5,sep=""),"p",paste("e",1:5,sep=""))
edges <- list( p = list(e1=dtout[oout[1]],e2=dtout[oout[2]],e3=dtout[oout[3]],e4=dtout[oout[4]],e5=dtout[oout[5]])
,i1=list(p=dtin[oin[1]]),i2=list(p=dtin[oin[2]]),i3=list(p=dtin[oin[3]]),i4=list(p=dtin[oin[4]]),i5=list(p=dtin[oin[5]]))
nflujo<-paste("flujo",codmun[kk],".pdf",sep="")
pdf(nflujo,width=9,height =  6)
#saldo migratorio
smig<-saldo[saldo$imun==codmun[kk],"smmt12"]
r <- makeRiver( nodes, edges,node_labels=c(paste(ndep[oin]," ",round(dtin[oin],2),"%",sep=""),ndep[i],paste(ndep[oout]," ",round(dtout[oout],2),"%",sep="")),
node_styles= list(p=list(col=colout[6]) ,i1=list(col=colout[1]),i2=list(col=colout[2])
,i3=list(col=colout[3]),i4=list(col=colout[4]),i5=list(col=colout[5])
, e1=list(col=colin[1]), e2=list(col=colin[2])
, e3=list(col=colin[3]), e4=list(col=colin[4]), e5=list(col=colin[5])))
plot(r,plot_area=0.7, node_margin = 0.2, nodewidth = 3,yscale=1)
pt<-par("usr")
#text(pt[2]/2,pt[4]/2,"Flujo Migratorio: Los 5 Principales Destinos de Entrada y Salida",cex=1.5,lwd=3,col="brown")
legend("top",paste("Saldo Migratorio:",smig,"Personas"),cex=1.2,col="red")
legend("bottomleft","Municipio de Origen",cex=0.8,text.col="blue")
legend("bottomright","Municipio de Destino",cex=0.8,text.col="blue")
dev.off()
kk<-kk+1
}
}
##########################
